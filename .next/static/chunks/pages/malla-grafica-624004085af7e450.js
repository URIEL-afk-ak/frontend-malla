(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[887],{1771:(e,a,t)=>{"use strict";t.r(a),t.d(a,{default:()=>h});var r=t(7876),i=t(4232),o=t(4521),s=t(7945),n=t(271),l=t(9590);t(2313);var d=t(9100);let c={materia:function(e){let a,{data:t,selected:i}=e,s=t.electiva?"#a21caf":"#ef4444",n=1;return t.opaca&&(n=.35),a=t.desbloqueadora?"linear-gradient(120deg,#dbeafe 60%,#2563eb 100%)":t.highlight?t.electiva?"linear-gradient(120deg,#ede9fe 60%,#a21caf 100%)":"linear-gradient(120deg,#fee2e2 60%,#ef4444 100%)":t.electiva?i?"linear-gradient(120deg,#ede9fe 60%,#a21caf 100%)":"linear-gradient(120deg,#f3e8ff 60%,#ede9fe 100%)":i?"linear-gradient(120deg,#fee2e2 60%,#ef4444 100%)":"linear-gradient(120deg,#fff1f2 60%,#fee2e2 100%)",(0,r.jsxs)("div",{style:{background:a,color:"#23272f",borderRadius:22,boxShadow:t.highlight?"0 0 0 8px #2563eb55":i?"0 0 0 6px ".concat(s,"55"):"0 4px 18px 0 #23272f18",padding:"2.2em 1.8em 1.8em 1.8em",minWidth:320,minHeight:110,maxWidth:400,fontWeight:700,fontSize:"1.55em",textAlign:"center",cursor:"pointer",transition:"box-shadow 0.18s, background 0.18s, opacity 0.18s",position:"relative",border:t.highlight?"3px solid #2563eb":i?"2.5px solid ".concat(s):"2px solid #e5e7eb",letterSpacing:"0.03em",textShadow:"0 2px 8px #23272f11",userSelect:"none",display:"flex",alignItems:"center",justifyContent:"center",opacity:n},children:[(0,r.jsx)(o.h7,{type:"target",position:"top",style:{background:s,width:10,height:10,borderRadius:5,border:"2px solid #fff"}}),(0,r.jsx)("span",{style:{flex:1,padding:"0 0.2em"},children:t.label}),(0,r.jsx)(o.h7,{type:"source",position:"bottom",style:{background:s,width:10,height:10,borderRadius:5,border:"2px solid #fff"}})]})}};function f(){let{malla:e,cargarMalla:a,loading:t,error:f}=(0,d.D)(),[h,g]=(0,i.useState)(null);(0,i.useEffect)(()=>{a()},[a]);let p=e.reduce((e,a)=>(e[a.anio]=e[a.anio]||[],e[a.anio].push(a),e),{}),u=Object.keys(p).map(Number).sort((e,a)=>e-a),x=[];u.forEach((a,t)=>{p[a].forEach((a,r)=>{let i=String(a.id),o=!1,s=!1,n=!1;if(h){var l;let a=e.find(e=>String(e.id)===h),t=(null==a||null==(l=a.correlativas)?void 0:l.map(e=>String(e.id)))||[],r=e.filter(e=>e.correlativas&&e.correlativas.some(e=>String(e.id)===h)).map(e=>String(e.id));t.includes(i)?s=!0:h===i||r.includes(i)||(n=!0),(t.includes(i)||r.includes(i))&&(o=!0)}x.push({id:i,type:"materia",position:{x:480*r,y:220*t},data:{label:a.nombre,estado:a.estado,electiva:a.electiva,highlight:o,desbloqueadora:s,opaca:n},style:{width:320},selected:h===i})})});let m=[];if(h){var b;let a=e.find(e=>String(e.id)===h);(null==a||null==(b=a.correlativas)?void 0:b.length)>0&&a.correlativas.forEach(e=>{m.push({id:"e".concat(e.id,"-").concat(a.id),source:String(e.id),target:String(a.id),animated:!0,style:{stroke:"url(#arrow-gradient)",strokeWidth:5,filter:"drop-shadow(0px 0px 6px #2563eb88)"},markerEnd:{type:"arrowclosed",color:"#2563eb",width:32,height:32}})}),e.forEach(e=>{e.correlativas&&e.correlativas.some(e=>String(e.id)===h)&&m.push({id:"e".concat(h,"-").concat(e.id),source:String(h),target:String(e.id),animated:!0,style:{stroke:"url(#arrow-gradient-green)",strokeWidth:4,strokeDasharray:"8 4",filter:"drop-shadow(0px 0px 6px #05966988)"},markerEnd:{type:"arrowclosed",color:"#059669",width:28,height:28}})})}return(0,r.jsxs)("div",{style:{width:"100%",height:700,background:"#fff",borderRadius:"16px",boxShadow:"0 2px 16px 0 #2563eb11",padding:"1.5em",marginBottom:"1.5em",overflow:"hidden"},children:[(0,r.jsx)("h2",{style:{fontWeight:700,fontSize:"1.3rem",marginBottom:"1.2rem",color:"#2563eb"},children:"Malla Gr\xe1fica con Correlativas"}),t&&(0,r.jsx)("div",{style:{color:"#2563eb",fontWeight:600},role:"status","aria-live":"polite",children:"Cargando..."}),f&&(0,r.jsx)("div",{style:{color:"#e11d48",fontWeight:600},role:"alert",children:f}),(0,r.jsxs)(o.Gc,{nodes:x,edges:m,nodeTypes:c,fitView:!0,panOnDrag:!0,zoomOnScroll:!0,zoomOnPinch:!0,minZoom:.2,maxZoom:2.5,onNodeClick:(e,a)=>g(a.id),children:[(0,r.jsx)("svg",{children:(0,r.jsxs)("defs",{children:[(0,r.jsxs)("linearGradient",{id:"arrow-gradient",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#2563eb"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#38bdf8"})]}),(0,r.jsxs)("linearGradient",{id:"arrow-gradient-green",x1:"0",y1:"0",x2:"1",y2:"0",children:[(0,r.jsx)("stop",{offset:"0%",stopColor:"#059669"}),(0,r.jsx)("stop",{offset:"100%",stopColor:"#22d3ee"})]})]})}),(0,r.jsx)(s.V,{}),(0,r.jsx)(n.H,{}),(0,r.jsx)(l.o,{nodeColor:e=>e.data.electiva?"#a21caf":"#ef4444"})]}),(0,r.jsx)("div",{style:{marginTop:"1em",color:"#64748b",fontSize:"1em"},children:"Puedes desplazarte y hacer zoom para explorar la malla. Haz click en una materia para resaltarla y ver sus correlativas."})]})}function h(){return(0,r.jsx)("div",{className:"container",children:(0,r.jsx)("div",{className:"card",children:(0,r.jsx)("div",{style:{background:"#f8fafc",borderRadius:"12px",padding:"1.2em"},children:(0,r.jsx)(f,{})})})})}},8470:(e,a,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/malla-grafica",function(){return t(1771)}])},9100:(e,a,t)=>{"use strict";t.d(a,{D:()=>n});var r=t(4232);async function i(){let e=await fetch("".concat("http://localhost:5000","/api/malla")),a=await e.json();if(!e.ok||"success"!==a.status)throw Error(a.message||"Error al obtener malla");return a.data}async function o(e,a){let t=await fetch("".concat("http://localhost:5000","/api/materias/").concat(e,"/estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nuevoEstado:a})}),r=await t.json();if(!t.ok||"success"!==r.status)throw Error(r.message||"Error al cambiar estado");return r.data}var s=t(89);function n(){let{materias:e,setMaterias:a,loading:t,setLoading:n,error:l,setError:d}=(0,s.j)();return{malla:e,loading:t,error:l,cargarMalla:(0,r.useCallback)(async()=>{n(!0),d(null);try{let e=await i();a(e)}catch(e){d(e.message)}finally{n(!1)}},[a,n,d]),actualizarEstado:async(e,t)=>{n(!0),d(null);try{let r=await o(e,t);console.log("Materias recibidas tras cambio de estado:",r),a(r)}catch(e){d(e.message)}finally{n(!1)}}}}}},e=>{e.O(0,[428,912,860,636,593,792],()=>e(e.s=8470)),_N_E=e.O()}]);