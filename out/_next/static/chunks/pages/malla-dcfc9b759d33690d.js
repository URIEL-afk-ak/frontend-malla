(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[347],{3338:(a,e,r)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/malla",function(){return r(5924)}])},5924:(a,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>d});var t=r(7876),s=r(4232),o=r(9100);let l={pendiente:{background:"#fff",color:"#ef4444",border:"1.5px solid #ef4444"},cursando:{background:"#fff",color:"#f59e42",border:"1.5px solid #f59e42"},regular:{background:"#fff",color:"#1d4ed8",border:"1.5px solid #1d4ed8"},aprobada:{background:"#fff",color:"#059669",border:"1.5px solid #059669"}};function i(a){let{estado:e}=a,r={display:"inline-block",borderRadius:"8px",padding:"2px 12px",fontSize:"0.85em",fontWeight:700,textTransform:"capitalize",letterSpacing:"0.01em",minWidth:60,textAlign:"center",margin:"0.1em 0",...l[e]||l.pendiente};return(0,t.jsx)("span",{style:r,children:e})}var n=r(8477);function c(a){let{mat:e,actualizarEstado:r,showToast:o}=a,[l,c]=(0,s.useState)(!1);return l?document.body.classList.add("modal-abierto"):document.body.classList.remove("modal-abierto"),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"materia-card ".concat(e.estado," ").concat(e.desbloqueada?"":"bloqueada"),tabIndex:0,"aria-label":"Materia ".concat(e.nombre),onClick:()=>c(!0),style:{background:"#fff",border:"2px solid #2563eb",borderRadius:10,color:"#1e293b",boxShadow:"0 2px 8px #2563eb22",fontWeight:700,fontSize:"1em",margin:"0.2em",padding:"0.7em 0.5em",transition:"box-shadow 0.2s, border 0.2s",cursor:"pointer"},onMouseOver:a=>a.currentTarget.style.boxShadow="0 4px 16px #2563eb44",onMouseOut:a=>a.currentTarget.style.boxShadow="0 2px 8px #2563eb22",children:[(0,t.jsx)("span",{className:e.electiva?"badge-electiva":"badge-obligatoria","aria-label":e.electiva?"Electiva":"Obligatoria",children:e.electiva?"★":"⬤"}),(0,t.jsx)("span",{className:"nombre",children:e.nombre}),(0,t.jsx)("div",{style:{margin:"0.15em auto 0.2em auto"},children:(0,t.jsx)(i,{estado:e.estado})}),!e.desbloqueada&&(0,t.jsx)("span",{className:"bloqueo",title:"Correlativas faltantes","aria-label":"Materia bloqueada",role:"img",tabIndex:0,children:"\uD83D\uDD12"})]}),l&&(0,n.createPortal)((0,t.jsx)("div",{className:"materia-modal-overlay",onClick:()=>c(!1),children:(0,t.jsxs)("div",{className:"materia-modal-content",onClick:a=>a.stopPropagation(),role:"dialog","aria-modal":"true","aria-label":e.desbloqueada?"Cambiar estado de ".concat(e.nombre):"Correlativas de ".concat(e.nombre),children:[(0,t.jsx)("button",{className:"cerrar",onClick:()=>c(!1),"aria-label":"Cerrar",children:"\xd7"}),(0,t.jsx)("div",{style:{fontWeight:700,fontSize:"1.1em",color:"#2563eb",textAlign:"center",marginBottom:"0.7em"},children:e.nombre}),e.desbloqueada?(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"modal-estados",children:["pendiente","cursando","regular","aprobada"].map(a=>(0,t.jsx)("button",{className:"btn-estado ".concat(a),disabled:e.estado===a,style:{opacity:e.estado===a?.6:1,minWidth:90},onClick:async t=>{if(t.stopPropagation(),e.estado!==a){try{await r(e.id,a),o("Estado actualizado","success")}catch(a){o(a.message||"Transici\xf3n inv\xe1lida","error")}c(!1)}},children:a.charAt(0).toUpperCase()+a.slice(1)},a))}),(0,t.jsxs)("div",{className:"correlativas",children:[(0,t.jsx)("span",{style:{fontWeight:600,color:"#a21caf"},children:"Correlativas requeridas para desbloquear:"}),Array.isArray(e.correlativas)?e.correlativas.length>0?(0,t.jsx)("ul",{children:e.correlativas.map((a,e)=>(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{style:{fontWeight:600},children:a.nombre}),(0,t.jsx)("span",{style:{marginLeft:"0.5em",fontSize:"0.95em",color:"regular"===a.tipo?"#0ea5e9":"#059669"},children:"regular"===a.tipo?" (Regular)":" (Aprobada)"})]},e))}):(0,t.jsx)("span",{style:{marginLeft:"0.5em"},children:"Ninguna"}):(0,t.jsx)("span",{style:{marginLeft:"0.5em"},children:"No se encontraron correlativas"})]})]}):(0,t.jsxs)("div",{className:"correlativas",children:[(0,t.jsx)("span",{style:{fontWeight:600,color:"#a21caf"},children:"Correlativas necesarias para desbloquear esta materia:"}),Array.isArray(e.correlativas)?e.correlativas.length>0?(0,t.jsx)("ul",{children:e.correlativas.map((a,e)=>(0,t.jsxs)("li",{children:[(0,t.jsx)("span",{style:{fontWeight:600},children:a.nombre}),(0,t.jsx)("span",{style:{marginLeft:"0.5em",fontSize:"0.95em",color:"regular"===a.tipo?"#0ea5e9":"#059669"},children:"regular"===a.tipo?" (Regular)":" (Aprobada)"})]},e))}):(0,t.jsx)("span",{style:{marginLeft:"0.5em"},children:"Ninguna"}):(0,t.jsx)("span",{style:{marginLeft:"0.5em"},children:"No se encontraron correlativas"})]})]})}),document.body)]})}function d(){let{malla:a,loading:e,error:r,cargarMalla:l,actualizarEstado:i}=(0,o.D)(),{showToast:n,Toast:d}=function(){let[a,e]=(0,s.useState)(null);return{showToast:function(a){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";e({msg:a,type:r}),setTimeout(()=>e(null),3e3)},Toast:()=>a?(0,t.jsx)("div",{className:"fixed top-4 right-4 px-4 py-2 rounded shadow text-white z-50 ".concat("error"===a.type?"bg-red-500":"bg-green-500"),children:a.msg}):null}}();(0,s.useEffect)(()=>{l()},[l]);let m=a.reduce((a,e)=>(a[e.anio]=a[e.anio]||[],a[e.anio].push(e),a),{}),u=Object.keys(m).map(Number).sort((a,e)=>a-e);return(0,t.jsxs)("div",{style:{width:"100vw",minHeight:"100vh",maxWidth:"100vw",margin:"0",padding:"4em 0 0 0",background:"#e5e7eb",boxSizing:"border-box",display:"flex",flexDirection:"column",alignItems:"center",overflowX:"hidden"},children:[e&&(0,t.jsx)("div",{style:{color:"#2563eb",fontWeight:600},role:"status","aria-live":"polite",children:"Cargando..."}),r&&(0,t.jsx)("div",{style:{color:"#e11d48",fontWeight:600},role:"alert",children:r}),(0,t.jsx)("div",{className:"malla-grid",children:u.map((a,e)=>(0,t.jsxs)("div",{className:"malla-anio-panel anio-".concat(e+1),children:[(0,t.jsxs)("div",{className:"malla-anio-header",children:[(0,t.jsx)("span",{className:"malla-anio-icon",children:"\uD83D\uDCC5"}),(0,t.jsxs)("span",{className:"malla-anio-titulo",children:["A\xf1o ",a]})]}),(0,t.jsx)("div",{className:"malla-anio-materias",children:m[a].map(a=>(0,t.jsx)(c,{mat:a,actualizarEstado:i,showToast:n},a.id))})]},a))}),(0,t.jsx)(d,{})]})}},9100:(a,e,r)=>{"use strict";r.d(e,{D:()=>i});var t=r(4232);async function s(){let a=await fetch("".concat("http://localhost:5000","/api/malla")),e=await a.json();if(!a.ok||"success"!==e.status)throw Error(e.message||"Error al obtener malla");return e.data}async function o(a,e){let r=await fetch("".concat("http://localhost:5000","/api/materias/").concat(a,"/estado"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({nuevoEstado:e})}),t=await r.json();if(!r.ok||"success"!==t.status)throw Error(t.message||"Error al cambiar estado");return t.data}var l=r(89);function i(){let{materias:a,setMaterias:e,loading:r,setLoading:i,error:n,setError:c}=(0,l.j)();return{malla:a,loading:r,error:n,cargarMalla:(0,t.useCallback)(async()=>{i(!0),c(null);try{let a=await s();e(a)}catch(a){c(a.message)}finally{i(!1)}},[e,i,c]),actualizarEstado:async(a,r)=>{i(!0),c(null);try{let t=await o(a,r);console.log("Materias recibidas tras cambio de estado:",t),e(t)}catch(a){c(a.message)}finally{i(!1)}}}}}},a=>{a.O(0,[636,593,792],()=>a(a.s=3338)),_N_E=a.O()}]);